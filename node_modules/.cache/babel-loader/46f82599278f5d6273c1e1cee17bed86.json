{"ast":null,"code":"function _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport logger from \"./logger\";\n\n// Responsible for ensuring channel subscribe command is confirmed, retrying until confirmation is received.\n// Internal class, not intended for direct user manipulation.\nvar SubscriptionGuarantor = /*#__PURE__*/function () {\n  function SubscriptionGuarantor(subscriptions) {\n    _classCallCheck(this, SubscriptionGuarantor);\n    this.subscriptions = subscriptions;\n    this.pendingSubscriptions = [];\n  }\n  return _createClass(SubscriptionGuarantor, [{\n    key: \"guarantee\",\n    value: function guarantee(subscription) {\n      if (this.pendingSubscriptions.indexOf(subscription) == -1) {\n        logger.log(\"SubscriptionGuarantor guaranteeing \".concat(subscription.identifier));\n        this.pendingSubscriptions.push(subscription);\n      } else {\n        logger.log(\"SubscriptionGuarantor already guaranteeing \".concat(subscription.identifier));\n      }\n      this.startGuaranteeing();\n    }\n  }, {\n    key: \"forget\",\n    value: function forget(subscription) {\n      logger.log(\"SubscriptionGuarantor forgetting \".concat(subscription.identifier));\n      this.pendingSubscriptions = this.pendingSubscriptions.filter(function (s) {\n        return s !== subscription;\n      });\n    }\n  }, {\n    key: \"startGuaranteeing\",\n    value: function startGuaranteeing() {\n      this.stopGuaranteeing();\n      this.retrySubscribing();\n    }\n  }, {\n    key: \"stopGuaranteeing\",\n    value: function stopGuaranteeing() {\n      clearTimeout(this.retryTimeout);\n    }\n  }, {\n    key: \"retrySubscribing\",\n    value: function retrySubscribing() {\n      var _this = this;\n      this.retryTimeout = setTimeout(function () {\n        if (_this.subscriptions && typeof _this.subscriptions.subscribe === \"function\") {\n          _this.pendingSubscriptions.map(function (subscription) {\n            logger.log(\"SubscriptionGuarantor resubscribing \".concat(subscription.identifier));\n            _this.subscriptions.subscribe(subscription);\n          });\n        }\n      }, 500);\n    }\n  }]);\n}();\nexport default SubscriptionGuarantor;","map":null,"metadata":{},"sourceType":"module"}